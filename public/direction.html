<!DOCTYPE html>
<html>

<head>
    <link href='//api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />
    <script src='//api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>

    <script src="//maps.googleapis.com/maps/api/js?key=AIzaSyBbiMiQFGG0YZrDP--XiSr45tPtizB3e84">
    </script>
</head>

<body>
    <script src="./lib/polyline.js"></script>
    <script src="//npmcdn.com/@turf/turf/turf.min.js"></script>
    <div id='map' style="width: 660px;height: 460px"></div>
    <script>
        L.mapbox.accessToken = 'pk.eyJ1IjoidGVobm5uIiwiYSI6ImNpZzF4bHV4NDE0dTZ1M200YWxweHR0ZzcifQ.lpRRelYpT0ucv1NN08KUWQ';
        var map = L.mapbox.map('map').setView([16, 100], 6);

        var googleStandard = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}&hl=th', {
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        });

        var basemap = {
            'แผนที่ฐาน': googleStandard.addTo(map)
        };
        var controlLayer = L.control.layers(basemap).addTo(map);

        var direction = function(origin, destination) {
            var directionsService = new google.maps.DirectionsService();
            var directionsRequest = {
                origin: origin,
                destination: destination,
                travelMode: google.maps.DirectionsTravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC
            };
            return new Promise(function(resolve, reject) {
                directionsService.route(directionsRequest, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        var data_encode = response.routes[0].overview_polyline;
                        resolve(data_encode)
                    } else {
                        reject("ผิดพลาด:" + status)
                    }
                })
            });
        };

        direction('เแม่ฮ่องสอน', 'นราธิวาส').then(function(result) {
            console.log(result)
            var json_line = polyline.toGeoJSON(result);

            var line_layer = L.mapbox.featureLayer(json_line).setStyle({
                weight: 5,
                color: 'blue',
                dashArray: 3
            }).addTo(map);
            controlLayer.addOverlay(line_layer, 'เส้นทาง1')
        }, function(err) {
            alert(err)
        });

        direction('รพ.สต.พระธาตุขิงแกง อ.จุน', 'โรงพยาบาลภูมิพล').then(function(result) {
            console.log(result)
            var json_line = polyline.toGeoJSON(result);
            var line_layer = L.mapbox.featureLayer(json_line).setStyle({
                weight: 5,
                color: 'lime',
                dashArray: 3
            }).addTo(map);
            controlLayer.addOverlay(line_layer, 'เส้นทาง2')
        }, function(err) {
            alert(err)
        });

        direction('13.9345,102.93455', 'พิษณุโลก').then(function(result) {
            console.log(result)
            var json_line = polyline.toGeoJSON(result);
            var line_layer = L.mapbox.featureLayer(json_line).setStyle({
                weight: 5,
                color: 'red',
                dashArray: 3
            }).addTo(map);
            controlLayer.addOverlay(line_layer, 'เส้นทาง3')
        }, function(err) {
            alert(err)
        });
    </script>
</body>

</html>